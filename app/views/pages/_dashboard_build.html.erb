<h2>Build Dashboard - "Build your self, build your skills, build your systems"</h2>

<div class="build-intro">
  <div class="collapsible-section">
    <h3 class="collapsible-header">Theory of Constraints: 5-Step Process <span class="toggle-icon">+</span></h3>
    <div class="collapsible-content hidden">
      <ol>
        <li>Identify the constraint</li>
        <li>Exploit the constraint</li>
        <li>Subordinate everything else to the constraint</li>
        <li>Elevate the constraint</li>
        <li>Repeat the process</li>
      </ol>
    </div>
  </div>

  <div class="collapsible-section">
    <h3 class="collapsible-header">Donella Meadows' 12 Leverage Points in Systems Thinking <span class="toggle-icon">+</span></h3>
    <div class="collapsible-content hidden">
      <ol>
        <li>The power to transcend paradigms</li>
        <li>The mindset or paradigm out of which the system arises</li>
        <li>The goals of the system</li>
        <li>The power to add, change, evolve, or self-organize system structure</li>
        <li>The rules of the system</li>
        <li>The structure of information flows</li>
        <li>The gain around driving positive feedback loops</li>
        <li>The strength of negative feedback loops</li>
        <li>The length of delays in the system</li>
        <li>The structure of material stocks and flows</li>
        <li>The size of buffers and other stabilizing stocks</li>
        <li>Constants, parameters, numbers</li>
      </ol>
    </div>
  </div>
</div>

<div class="overall-percentage">Build Progress: <span id="buildOverallPercentage">0</span>%</div>

<div class="diamond-container build-diamond">
  <div class="diamond-square" data-build-area="homo-memetic-techno-capital">
    <span class="square-title">Homo-Memetic-Techno-Capital</span>
    <span class="square-percentage">0%</span>
  </div>
  <div class="diamond-square" data-build-area="skillful">
    <span class="square-title">Skillful</span>
    <span class="square-percentage">0%</span>
  </div>
  <div class="diamond-square" data-build-area="purpose-programming">
    <span class="square-title">Purpose/Programming</span>
    <span class="square-percentage">0%</span>
  </div>
  <div class="diamond-square" data-build-area="individual-configurability">
    <span class="square-title">Individual Configurability</span>
    <span class="square-percentage">0%</span>
  </div>
</div>

<div class="build-details">
  <h3>Build Areas</h3>
  <ul>
    <li><strong>Homo-Memetic-Techno-Capital:</strong> Integration of human, memetic, technological, and capital resources</li>
    <li><strong>Skillful:</strong> Development and mastery of relevant skills</li>
    <li><strong>Purpose/Programming:</strong> Aligning purpose with programming capabilities</li>
    <li><strong>Individual Configurability:</strong> Customization and adaptability to individual needs</li>
  </ul>
</div>

<!-- 6 categories -->
<div class="dashboard-grid">
  <div id="model" class="dashboard-section model">
    <h3>Model</h3>
    <p>Description of the Build model goes here.</p>
  </div>

  <div id="analogy" class="dashboard-section analogy">
    <h3>Analogy</h3>
    <p>An analogy explaining Build concept goes here.</p>
  </div>

  <div id="equation" class="dashboard-section equation">
    <h3>Equation of Mastery</h3>
    <p>Mastery of Systems (I Know with Clarity) = (Input Responsibility * Maximise Productivity * Minimise Bottlenecks) + (Process of Iterating * Inner Integrity * Outer Solving)</p>
  </div>

  <div id="metrics" class="dashboard-section metrics">
    <h3>Throughput Metrics for Build</h3>
    <ul>
      <li>Throughput or Impactful Activity: %</li>
      <li>Operational Expense or Energised Tranquility: %</li>
      <li>Investment or Profound Experience: %</li>
    </ul>
  </div>

  <div id="practice" class="dashboard-section practice">
    <h3>Practice</h3>
    <p>Problem solve, iterate, experiment and build better systems. 12 Leverage points and 5 step process.</p>
  </div>

  <div id="graph" class="dashboard-section graph">
    <h3>Graph of Inputs</h3>
    <p>Fractal systems as starting as 4 primary partions. A system has stocks, flows, metrics and goals. Inputs, Function, output and feedback.</p>
    <div id="buildGraph"></div>
  </div>
</div>

<style>
  .build-intro {
    margin-bottom: 2rem;
  }

  .collapsible-section {
    background-color: #2c2c2c;
    border-radius: 8px;
    margin-bottom: 1rem;
    box-shadow: 0 2px 4px rgba(255,255,255,0.1);
  }

  .collapsible-header {
    padding: 1rem;
    margin: 0;
    cursor: pointer;
    display: flex;
    justify-content: space-between;
    align-items: center;
  }

  .collapsible-content {
    overflow: hidden;
    transition: max-height 0.3s ease-out, padding 0.3s ease-out;
    max-height: 0;
    padding: 0 1rem;
  }

  .collapsible-content.active {
    max-height: 1000px; /* Adjust this value based on your content */
    padding: 1rem;
  }

  .toggle-icon {
    transition: transform 0.3s ease-out;
  }

  .toggle-icon.open {
    transform: rotate(45deg);
  }

  .build-diamond {
    width: 300px;
    height: 300px;
  }

  .build-diamond .diamond-square {
    width: 140px;
    height: 140px;
  }

  .build-details {
    margin-top: 2rem;
  }

  .build-details ul {
    list-style-type: none;
    padding-left: 0;
  }

  .build-details li {
    margin-bottom: 0.5rem;
  }

  .dashboard-grid {
    display: grid;
    grid-template-columns: repeat(2, 1fr);
    gap: 20px;
    margin-top: 2rem;
  }

  .dashboard-section {
    background-color: #2c2c2c;
    border-radius: 8px;
    padding: 15px;
    box-shadow: 0 2px 4px rgba(255,255,255,0.1);
    color: #ffffff;
  }

  .dashboard-section h3 {
    margin-top: 0;
    margin-bottom: 10px;
  }

  .diamond-square span {
    font-size: 0.8rem;
  }
</style>

<script>
function initCollapsible() {
  const collapsibleHeaders = document.querySelectorAll('.collapsible-header');
  collapsibleHeaders.forEach(header => {
    header.addEventListener('click', function() {
      const content = this.nextElementSibling;
      const toggleIcon = this.querySelector('.toggle-icon');
      
      content.classList.toggle('active');
      toggleIcon.classList.toggle('open');
      toggleIcon.textContent = content.classList.contains('active') ? '-' : '+';
      
      console.log('Clicked header:', this.textContent);
      console.log('Content active:', content.classList.contains('active'));
    });
  });

  console.log('Number of collapsible headers:', collapsibleHeaders.length);
}

// Call initCollapsible when the DOM is loaded
document.addEventListener('DOMContentLoaded', initCollapsible);

// If using Turbolinks, also add this:
document.addEventListener('turbolinks:load', initCollapsible);

// Existing JavaScript for updateBuildPercentages, etc.
document.addEventListener('DOMContentLoaded', function() {
  function updateBuildPercentages() {
    const buildOverallPercentage = document.getElementById('buildOverallPercentage');
    const squarePercentages = document.querySelectorAll('.build-diamond .square-percentage');
    
    let total = 0;
    squarePercentages.forEach(span => {
      const percentage = Math.floor(Math.random() * 101);
      span.textContent = `${percentage}%`;
      total += percentage;
    });
    
    const average = Math.round(total / squarePercentages.length);
    buildOverallPercentage.textContent = average;
  }

  // Update percentages on page load (for demonstration)
  updateBuildPercentages();

  // Add click event listeners to the diamond squares
  const buildSquares = document.querySelectorAll('.build-diamond .diamond-square');
  buildSquares.forEach(square => {
    square.addEventListener('click', function() {
      const buildArea = this.getAttribute('data-build-area');
      alert(`Clicked on ${buildArea} area. You can add specific actions or information for this build area.`);
    });
  });

  // Graph initialization
  const ctx = document.getElementById('buildGraph').getContext('2d');
  new Chart(ctx, {
    type: 'line',
    data: {
      labels: ['Jan', 'Feb', 'Mar', 'Apr', 'May', 'Jun'],
      datasets: [{
        label: 'Build Progress',
        data: [0, 10, 20, 30, 40, 50],
        borderColor: 'rgb(255, 206, 86)',
        tension: 0.1
      }]
    },
    options: {
      responsive: true,
      scales: {
        y: {
          beginAtZero: true
        }
      }
    }
  });
});
</script>
